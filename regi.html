<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Registration | POP N' PLAN</title>
  <link rel="icon" href="logo.png" type="image/x-icon">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Saira',sans-serif; }

    body {
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:linear-gradient(135deg,#f9f9ff,#e8f0ff,#fef6ff);
      overflow-y:auto;
    }

    /* Floating bubbles background */
    .bubble {
      position:absolute;
      border-radius:50%;
      background:rgba(108,92,231,0.15);
      animation: float 8s infinite;
      z-index:0;
    }
    .bubble:nth-child(1) { width:120px;height:120px;top:10%;left:15%; }
    .bubble:nth-child(2) { width:80px;height:80px;top:70%;left:25%; }
    .bubble:nth-child(3) { width:100px;height:100px;top:40%;right:20%; }
    .bubble:nth-child(4) { width:150px;height:150px;bottom:10%;right:10%; }

    @keyframes float {
      0% { transform:translateY(0px); }
      50% { transform:translateY(-20px); }
      100% { transform:translateY(0px); }
    }

    /* Container */
    .container {
      position:relative;
      z-index:1;
      width:100%;
      max-width:650px;
      margin:40px auto;
      padding:40px;
      border-radius:20px;
      background:rgba(255,255,255,0.2);
      box-shadow:0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter:blur(12px);
    }

    .logo {
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:20px;
    }
    .logo img {
      width:40px; height:40px; border-radius:10px;
    }
    .logo h2 {
      font-size:20px;
      font-weight:800;
      background:linear-gradient(90deg,#6c5ce7,#ff6ec4);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }

    h1 {
      text-align:center;
      margin-bottom:25px;
      font-size:28px;
      font-weight:700;
      color:#333;
    }

    form {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
    }

    .form-group {
      display:flex;
      flex-direction:column;
    }
    .form-group label {
      font-weight:600;
      margin-bottom:6px;
      color:#444;
      font-size:14px;
    }
    .form-group input {
      padding:12px 14px;
      border:none;
      border-radius:10px;
      background:rgba(255,255,255,0.6);
      box-shadow:inset 0 2px 6px rgba(0,0,0,0.05);
      font-size:14px;
      outline:none;
    }
    .form-group input:focus {
      border:2px solid #6c5ce7;
      background:#fff;
    }

    .form-group.full { grid-column:1 / span 2; }

    .submit-btn {
      grid-column:1 / span 2;
      padding:14px;
      border:none;
      border-radius:12px;
      background:linear-gradient(90deg,#6c5ce7,#ff6ec4);
      color:#fff;
      font-size:16px;
      font-weight:700;
      cursor:pointer;
      transition:0.3s;
    }
    .submit-btn:hover { opacity:0.9; }
  </style>
</head>
<body>
  <!-- Bubbles -->
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>

  <div class="container">
    <div class="logo">
      <img src="logo.png" alt="POP N' PLAN Logo">
      <h2>POP N' PLAN</h2>
    </div>
    <h1>Event Registration</h1>

    <form id="registrationForm">
      <div class="form-group">
        <label for="name">Full Name *</label>
        <input type="text" id="name" name="registrantName" required>
      </div>
      <div class="form-group">
        <label for="email">Email *</label>
        <input type="email" id="email" name="registrantEmail" required>
      </div>
      <div class="form-group">
        <label for="phone">Phone Number *</label>
        <input type="tel" id="phone" name="registrantPhone" required>
      </div>
      <div class="form-group">
        <label for="class">Class *</label>
        <input type="text" id="class" name="registrantClass" required>
      </div>
      <div class="form-group">
        <label for="roll">Roll No *</label>
        <input type="text" id="roll" name="registrantRollNo" required>
      </div>
      <div class="form-group">
        <label for="prn">PRN No *</label>
        <input type="text" id="prn" name="registrantPRN" required>
      </div>
      <div class="form-group full">
        <label for="aadhar">Upload Aadhaar Card *</label>
        <input type="file" id="aadhar" name="aadharFile" accept="image/*,.pdf" required>
      </div>
      <div class="form-group full">
        <label for="receipt">Upload Fee Receipt *</label>
        <input type="file" id="receipt" name="receiptFile" accept="image/*,.pdf" required>
      </div>
      <button type="submit" class="submit-btn">Submit Registration</button>
    </form>
  </div>

  <script>
    // Get event ID from localStorage (set by event.html)
    const eventId = localStorage.getItem('selectedEventId');
    
    // Display event information if available
    if (eventId) {
      loadEventInfo(eventId);
    }

    // Load event information
    async function loadEventInfo(eventId) {
      try {
        const response = await fetch(`/api/events/${eventId}`);
        if (response.ok) {
          const event = await response.json();
          document.querySelector('h1').textContent = `Register for: ${event.title}`;
          
          // Add event details below the title
          const eventDetails = document.createElement('div');
          eventDetails.style.cssText = 'text-align: center; margin: 10px 0 20px; color: #666; font-size: 14px;';
          eventDetails.innerHTML = `
            <p><strong>Date:</strong> ${new Date(event.date).toLocaleDateString()}</p>
            <p><strong>Time:</strong> ${event.time}</p>
            <p><strong>Venue:</strong> ${event.venue || 'TBD'}</p>
          `;
          document.querySelector('h1').insertAdjacentElement('afterend', eventDetails);
        }
      } catch (error) {
        console.error('Error loading event info:', error);
      }
    }

    // Handle form submission
    document.getElementById('registrationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!eventId) {
        alert('No event selected. Please go back to the events page and select an event to register.');
        return;
      }

      const formData = new FormData(e.target);
      const registrationData = {
        registrantName: formData.get('registrantName'),
        registrantEmail: formData.get('registrantEmail'),
        registrantPhone: formData.get('registrantPhone'),
        registrantClass: formData.get('registrantClass'),
        registrantRollNo: formData.get('registrantRollNo'),
        registrantPRN: formData.get('registrantPRN')
      };

      // Validate required fields
      const requiredFields = ['registrantName', 'registrantEmail', 'registrantPhone', 'registrantClass', 'registrantRollNo', 'registrantPRN'];
      for (const field of requiredFields) {
        if (!registrationData[field]) {
          alert(`Please fill in the ${field.replace('registrant', '').toLowerCase()} field.`);
          return;
        }
      }

      // Show loading state
      const submitBtn = e.target.querySelector('.submit-btn');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Submitting...';
      submitBtn.disabled = true;

      try {
        const response = await fetch(`/api/events/${eventId}/register`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(registrationData)
        });

        const result = await response.json();

        if (response.ok) {
          alert('Registration successful! You will receive a confirmation email shortly.');
          e.target.reset();
          // Clear the selected event ID
          localStorage.removeItem('selectedEventId');
          // Redirect back to events page
          setTimeout(() => {
            window.location.href = 'event.html';
          }, 2000);
        } else {
          throw new Error(result.error || 'Registration failed');
        }
      } catch (error) {
        console.error('Registration error:', error);
        alert('Registration failed: ' + error.message);
      } finally {
        // Reset button state
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    });

    // Add some visual feedback for file uploads
    document.querySelectorAll('input[type="file"]').forEach(input => {
      input.addEventListener('change', (e) => {
        const fileName = e.target.files[0]?.name;
        if (fileName) {
          const label = e.target.previousElementSibling;
          label.textContent = label.textContent.replace('*', `* (${fileName})`);
        }
      });
    });
  </script>
</body>
</html>
